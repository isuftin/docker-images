#! /bin/sh
#
#  File - nhm
#
#  Purpose - Controller script for National Hydrologic Model (NHM).
#
#  Author - Andrew Halper
#

# if ofp, HRU shapefiles are not present...
if [ ! -d /var/lib/nhm/ofp/Data ]; then
    # ...download them
    wget -P /var/lib/nhm/ofp \
      ftp://ftpext.usgs.gov/pub/cr/co/denver/BRR-CR/pub/rmcd/Data_hru_shp.tar.gz

    if [ ! -d /var/lib/nhm/ofp/Data ]; then
	cd /var/lib/nhm/ofp && tar -xvzf Data_hru_shp.tar.gz
	rm -f /var/lib/nhm/ofp/Data_hru_shp.tar.gz
    fi
fi

# if PRMS workspace is not present...
if [ ! -d /var/lib/nhm/NHM-PRMS_CONUS ]; then
    # ...download it
    wget -P /var/lib/nhm "$conus" \
 ftp://ftpint.usgs.gov/pub/cr/co/denver/BRR-CR/pub/markstro/NHM-PRMS_CONUS.zip

    # if download of the archive succeeded...
    file=`file -b /var/lib/nhm/NHM-PRMS_CONUS.zip`
    if [ "$file" = 'Zip archive data, at least v2.0 to extract' ]; then
	cd /var/lib/nhm && unzip -o NHM-PRMS_CONUS # ...uncompress
	rm -f /var/lib/nhm/NHM-PRMS_CONUS.zip
    fi
fi

# TODO: run ofp

# TODO: should only be relevant in development
sleep infinity
